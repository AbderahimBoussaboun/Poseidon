<div class="row">
    <div class="col-xxl-4"><h2>Infrastructures</h2></div>
    <div class="col-xxl-8">
        <div class="mt-3">
            <button *ngIf="loaded" class="btn btn-success float-end" data-bs-toggle="modal" data-bs-target="#addServer" type="submit" (click)="resetFormValues()">Add Server</button>
            <div *ngIf="loaded"><input type="text" class="form-control search-field poseidon-text-search float-end me-2" name="searchText" placeholder="Search Here" [(ngModel)]="searchText"></div>
        </div>
    </div>
</div>
<div class="row mt-4">
    <table *ngIf="servers && servers.length > 0 && loaded" class="table table-striped" style="text-align:center;">
        <thead>
            <tr>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="name">Server Name</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="ip">IP</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="os">OS</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="location">Location</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="environmentId">Environment</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="infrastructureId">Infrastructure</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="productId">Product</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="dateInsert">Insertion Date</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="dateModify">Modification Date</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="dateDisable">Deactivation Date</th>
                <th scope="col" [appSort]="servers" data-order="desc" data-name="active">Active</th>
                <td>Action</td>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let i of $any (servers | searchFilter: searchText | slice: (page-1) * pageSize : page * pageSize)">
                <td>
                    <a routerLink="/administration/servers/{{i.id}}/roles">{{i.name}}</a>
                </td>
                <td>{{i.ip}}</td>
                <td>{{i.os}}</td>
                <td>{{i.location}}</td>
                <td align="center">
                    <div *ngFor="let e of environments">
                        <td *ngIf="e.id == i.environmentId">{{e.name}}</td>
                    </div>
                </td>
                <td align="center">
                    <div *ngFor="let inf of infrastructures">
                        <td *ngIf="inf.id == i.infrastructureId">{{inf.name}}</td>
                    </div>
                </td>
                <td align="center">
                    <div *ngFor="let j of products">
                        <td *ngIf="j.id == i.productId">{{j.name}}</td>
                    </div>
                </td>
                <td>{{i.dateInsert}}</td>
                <td>{{i.dateModify}}</td>
                <td>{{i.dateDisable}}</td>
                <td>{{i.active}}</td>
                <td>
                    <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal"
                        data-bs-target="#editServer" (click)="modifyServer(i)">Edit</button>
                    <button type="button" class="btn btn-danger" (click)="openDialog(i)">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>
    <ngb-pagination *ngIf="loaded && servers && servers.length > 0" [(page)]="page" [pageSize]="pageSize" [collectionSize]="servers.length"></ngb-pagination>

    <div *ngIf="servers?.length == 0 && loaded">
        Upsss... There are not servers
    </div>

    <!-- Modal Add Server -->
    <div class="modal fade" id="addServer" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">New Server</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form [formGroup]="serverForm">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" formControlName="name" class="form-control" id="name"
                                aria-describedby="emailHelp" oninput="this.value = this.value.toUpperCase()">
                            <span *ngIf="serverForm.get('name')?.invalid && serverForm.get('name')?.touched"
                                class="text-danger">
                                The <strong>name</strong> is required
                            </span>
                        </div>
                        <div class="mb-3">
                            <label for="ip" class="form-label">IP</label>
                            <input type="text" formControlName="ip" class="form-control" id="ip"
                                aria-describedby="emailHelp">
                            <span *ngIf="serverForm.get('ip')?.invalid && serverForm.get('ip')?.touched"
                                class="text-danger">
                                The <strong>IP</strong> is required
                            </span>
                        </div>
                        <div class="mb-3">
                            <label for="os" class="form-label">OS</label>
                            <select class="form-select" id="os" formControlName="os">
                                <option value="Windows Server 2008">Windows Server 2008</option>
                                <option value="Windows Server 2008 R2">Windows Server 2008 R2</option>
                                <option value="Windows Server 2012">Windows Server 2012</option>
                                <option value="Windows Server 2012 R2">Windows Server 2012 R2</option>
                                <option value="Windows Server 2016">Windows Server 2016</option>
                                <option value="Windows Server 2019">Windows Server 2019</option>
                                <option value="Windows Server 2022">Windows Server 2022</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="location" class="form-label">Location</label>
                            <select class="form-select" id="location" formControlName="location">
                                <option value="OnPremise">OnPremise</option>
                                <option value="Azure">Azure</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="productId" class="form-label">Product Name</label>
                            <select class="form-select" id="productId" formControlName="productId">
                                <option *ngFor="let p of products" [ngValue]="p.id">{{ p.name }}</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="environmentId" class="form-label">Environment</label>
                            <select class="form-select" id="environmentId" formControlName="environmentId">
                                <option *ngFor="let e of environments" [ngValue]="e.id">{{ e.name }}</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="infrastructureId" class="form-label">Infrastructure</label>
                            <select class="form-select" id="infrastructureId" formControlName="infrastructureId">
                                <option *ngFor="let i of infrastructures" [ngValue]="i.id">{{ i.name }}</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="active" class="form-label">Active</label>
                            <select class="form-select" id="active" formControlName="active">
                                <option [ngValue]="true">Yes</option>
                                <option [ngValue]="false">No</option>
                            </select>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" [disabled]="serverForm.invalid" class="btn btn-success float-end"
                                data-bs-dismiss="modal" (click)="addServer()">Add Server</button>
                        </div>
                    </form>

                </div>

            </div>
        </div>
    </div>

    <!-- Modal Edit Server -->
    <div class="modal fade" id="editServer" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit Server</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form [formGroup]="serverForm">
                        <div class="mb-3">
                            <label for="name" class="form-label">Server Name</label>
                            <input type="text" formControlName="name" class="form-control" id="name"
                                aria-describedby="emailHelp" oninput="this.value = this.value.toUpperCase()">
                            <span *ngIf="serverForm.get('name')?.invalid && serverForm.get('name')?.touched"
                                class="text-danger">
                                The <strong>name</strong> is required
                            </span>
                        </div>
                        <div class="mb-3">
                            <label for="ip" class="form-label">IP</label>
                            <input type="text" formControlName="ip" class="form-control" id="ip"
                                aria-describedby="emailHelp">
                            <span *ngIf="serverForm.get('ip')?.invalid && serverForm.get('ip')?.touched"
                                class="text-danger">
                                The <strong>IP</strong> is required
                            </span>
                        </div>
                        <div class="mb-3">
                            <label for="os" class="form-label">OS</label>
                            <select class="form-select" id="os" formControlName="os">
                                <option value="Windows Server 2008">Windows Server 2008</option>
                                <option value="Windows Server 2008 R2">Windows Server 2008 R2</option>
                                <option value="Windows Server 2012">Windows Server 2012</option>
                                <option value="Windows Server 2012 R2">Windows Server 2012 R2</option>
                                <option value="Windows Server 2016">Windows Server 2016</option>
                                <option value="Windows Server 2019">Windows Server 2019</option>
                                <option value="Windows Server 2022">Windows Server 2022</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="location" class="form-label">Location</label>
                            <select class="form-select" id="location" formControlName="location">
                                <option value="OnPremise">OnPremise</option>
                                <option value="Azure">Azure</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="productId" class="form-label">Product Name</label>
                            <select class="form-select" id="productId" formControlName="productId">
                                <option *ngFor="let p of products" [ngValue]="p.id">{{ p.name }}</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="environmentId" class="form-label">Environment</label>
                            <select class="form-select" id="environmentId" formControlName="environmentId">
                                <option *ngFor="let e of environments" [ngValue]="e.id">{{ e.name }}</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="infrastructureId" class="form-label">Infrastructure</label>
                            <select class="form-select" id="infrastructureId" formControlName="infrastructureId">
                                <option *ngFor="let i of infrastructures" [ngValue]="i.id">{{ i.name }}</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="active" class="form-label">Active</label>
                            <select class="form-select" id="active" formControlName="active">
                                <option [ngValue]="true">Yes</option>
                                <option [ngValue]="false">No</option>
                            </select>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" [disabled]="serverForm.invalid" class="btn btn-outline-success" data-bs-dismiss="modal"
                                (click)="updateServer()">Save
                                Changes</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>